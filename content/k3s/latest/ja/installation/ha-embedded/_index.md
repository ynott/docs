---
title: "組み込みDB(試験実装)によるHA構成"
weight: 40
---

v1.0.0から、K3sで外部データベースを使用しない高可用性コントロールプレーンを試験的にサポートしています。つまり信頼性の必要な本番レベルの環境を構築するために、外部etcdやSQLデータストアの管理は必要ありません。この機能は現在試験的なものですが、将来的にはHA構成のK3sクラスターを動かすための主要なアーキテクチャになると考えています。

このアーキテクチャには、K3sサーバプロセス内にdqliteデータベースが組み込まれています。DQLiteは"分散SQLite"の略で、https://dqlite.io によると"*IoTデバイスやEdgeデバイスを堅牢にするのに最適なRaftのコンセンサスによる高速で埋め込み型の永続的SQLデータベース*"です。K3sでの利用に適しています。

このモードでK3sを実行するには、奇数のサーバーノードが必要です。3つのノードから開始することをお勧めします。

まず、クラスター化を有効にする`cluster-init`フラグを付け、サーバーをクラスタに追加する時の共有シークレットキーとして必要なトークンを定義した状態でサーバノードを起動します。
```
K3S_TOKEN=SECRET k3s server --cluster-init
```

最初のサーバーを起動した後、共有シークレットキーを使用して2番目と3番目のサーバーをクラスターに参加させます:
```
K3S_TOKEN=SECRET k3s server --server https://<1台目のサーバーのIPアドレスかホスト名>:6443
```

これで、高可用性のコントロールプレーンができました。後は単一サーバークラスターと同じ手順でワーカーノードをクラスターに追加します。
